---
layout: default
title: 开源项目
menu: open-source
---

<section class="container">
    <header class="centered">
        <h1>开源项目</h1>
        <p class="lead">共[repoCount]个项目</p>
    </header>
    <div class="repo-list">
        <ul class="collection-listing clearfix">

        </ul>
    </div>
</section>
<div id="repoTemplate" class="hidden">
    <li class="collection-card">
        <a href="[url]" class="collection-card-image geopattern" data-pattern-id="[name]">
            <h3 class="collection-card-title">[name]</h3>
        </a>
        <p class="collection-card-body">[description]</p>
        <div class="collection-card-meta">
                <span class="meta-info tooltipped tooltipped-n [languageClass]">[language]</span>
                <span class="meta-info tooltipped tooltipped-n">
                    <span class="octicon octicon-star"></span> [stars]</span>
                <span class="meta-info tooltipped tooltipped-n">
                    <span class="octicon octicon-git-branch"></span> [forks]
                </span>
                <span class="meta-info tooltipped tooltipped-n" aria-label="最后更新于：[updated_at]">
                    <span class="octicon octicon-clock"></span>
                    <time datetime="[updated_at]" title="[updated_at]"> [updated_at]</time>
                </span>
        </div>
    </li>
</div>
<script>
  var repos = [];

  {% for repo in site.github.public_repositories %}
    var repo = {
      name: "{{repo.name}}",
      html_url: "{{repo.html_url}}",
      description: "{{repo.description}}",
      homepage: "{{repo.homepage}}",
      language: "{{repo.language}}",
      stars: {{repo.stargazers_count}},
      forks: {{repo.forks_count}},
      fork: {{repo.fork}},
      updated_at: "{{ repo.updated_at | date: "%F" }}"
    };
    repos.push(repo);
  {% endfor %}
</script>
<script>
    if (!Array.prototype.indexOf) {
      Array.prototype.indexOf = function(elt /*, from*/) {
        var len = this.length >>> 0,
            from = Number(arguments[1]) || 0;
        from = (from < 0) ? Math.ceil(from) : Math.floor(from);
        if (from < 0)
          from += len;

        for (; from < len; from++) {
          if (from in this && this[from] === elt)
            return from;
        }
        return -1;
      };
    }

    function template (data) {
        var source = $('#repoTemplate').html();
        var ul = '';

        $.each(data.items, function(index, repo) {
            var t = source;
            for (i in repo) {
                var property = repo[i];
                t = t.replace(new RegExp('\\['+i+'\\]', 'g'), property);
            }

            ul += t;
        });

        return ul;
    }

    $(document).ready(function(){
        var $ignoreForks = true;
        var repoList = $('.repo-list ul');
         var o = this,
            repoCount = 0;

        var items = [],
            item = {},
            data = {};

        $.each(repos, function (i, repo) {
            // Ignore forked repos
            if (o.$ignoreForks && repo.fork) {
                return;
            }

            // Opt-in repos (name) and custom repos (full_name) only
            repoCount = repoCount + 1;

            repo.languageClass = (repo.language || '').toLowerCase();

              // Make sure homepage URLs start with http. If not, add them
              if (repo.homepage && repo.homepage.substring(0, 4) != "http") {
                repo.homepage = 'http://' + repo.homepage;
              }

              item = {
                url: repo.html_url,
                name: repo.name,
                language: repo.language,
                languageClass: repo.languageClass,
                description: repo.description,
                stars: repo.stargazers_count ? repo.stargazers_count : 0,
                forks: repo.forks_count ? repo.forks_count : 0,
                avatar: null,
                updated_at: repo.updated_at,
                homepage: repo.homepage
              };

              items.push(item);
            });

            // Sort by stars
            items.sort(function(a,b) {
              if (a.stars < b.stars) return 1;
              if (b.stars < a.stars) return -1;
              return 0;
            });

            // Create handlebars.js data
            data = { items: items };

            // Append handlebars templates
            repoList.addClass('is-loaded').append(template(data));
    });
</script>